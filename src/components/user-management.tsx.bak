'use client';

import { useState, useEffect } from 'react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { ScrollArea } from '@/components/ui/scroll-area';
import { Badge } from '@/components/ui/badge';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from '@/components/ui/dialog';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';
import { Plus, Pencil, Trash2, Users, Shield, Search, Key, Lock, AlertCircle, EyeOff } from 'lucide-react';
import { useAuth } from '@/lib/auth-context';

interface User {
  id: string;
  username: string;
  email: string;
  name?: string;
  role: 'ADMIN' | 'BRANCH_MANAGER' | 'CASHIER';
  branchId?: string;
  branchName?: string;
  isActive: boolean;
  createdAt: Date;
}

interface UserFormData {
  username: string;
  email: string;
  name?: string;
  role: 'ADMIN' | 'BRANCH_MANAGER' | 'CASHIER';
  branchId?: string;
}

interface ChangePasswordData {
  newPassword: string;
  confirmPassword: string;
}

const roles = [
  { value: 'ADMIN', label: 'HQ Admin', description: 'Full control over all branches' },
  { value: 'BRANCH_MANAGER', label: 'Branch Manager', description: 'Manage single branch inventory and staff' },
  { value: 'CASHIER', label: 'Cashier', description: 'Process sales only' },
];

export default function UserManagement() {
  const { user: currentUser } = useAuth();
  const [users, setUsers] = useState<User[]>([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [roleFilter, setRoleFilter] = useState<string>('all');
  const [dialogOpen, setDialogOpen] = useState(false);
  const [passwordDialogOpen, setPasswordDialogOpen] = useState(false);
  const [editingUser, setEditingUser] = useState<User | null>(null);
  const [passwordTargetUser, setPasswordTargetUser] = useState<User | null>(null);
  const [formData, setFormData] = useState<UserFormData>({
    username: '',
    email: '',
    name: '',
    role: 'CASHIER',
    branchId: '',
  });
  const [passwordData, setPasswordData] = useState<ChangePasswordData>({
    newPassword: '',
    confirmPassword: '',
  });
  const [loading, setLoading] = useState(false);
  const [passwordLoading, setPasswordLoading] = useState(false);
  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null);

  useEffect(() => {
    fetchUsers();
  }, []);

  const fetchUsers = async () => {
    setLoading(true);
    try {
      const response = await fetch('/api/users');
      const data = await response.json();

      if (response.ok && data.users) {
        setUsers(data.users);
      }
    } catch (error) {
      console.error('Failed to fetch users:', error);
    } finally {
      setLoading(false);
    }
  };

  // Check if current user can change target user's password
  const canChangePassword = (targetUser: User) => {
    if (!currentUser) return false;

    // HQ Admin: Can change any user's password
    if (currentUser.role === 'ADMIN') {
      return true;
    }

    // Branch Manager: Can change their own password and their cashiers' passwords
    if (currentUser.role === 'BRANCH_MANAGER') {
      // Can change their own password
      if (currentUser.id === targetUser.id) {
        return true;
      }

      // Can change their cashiers' passwords (same branch)
      if (targetUser.role === 'CASHIER' && targetUser.branchId === currentUser.branchId) {
        return true;
      }
    }

    // Cashier: Cannot change passwords
    return false;
  };

  const canEditUser = (user: User) => {
    if (!currentUser) return false;

    // HQ Admin: Can edit any user
    if (currentUser.role === 'ADMIN') {
      return true;
    }

    // Branch Manager: Can only edit users in their branch (not other managers)
    if (currentUser.role === 'BRANCH_MANAGER') {
      // Can edit themselves
      if (currentUser.id === user.id) {
        return true;
      }
      // Can only edit cashiers in their branch
      if (user.role === 'CASHIER' && user.branchId === currentUser.branchId) {
        return true;
      }
      return false;
    }

    // Cashier: Cannot edit users
    return false;
  };

  const canDeleteUser = (user: User) => {
    if (!currentUser) return false;

    // HQ Admin: Can delete any user except themselves
    if (currentUser.role === 'ADMIN') {
      return currentUser.id !== user.id;
    }

    // Branch Manager: Can only delete cashiers in their branch
    if (currentUser.role === 'BRANCH_MANAGER') {
      return user.role === 'CASHIER' && user.branchId === currentUser.branchId;
    }

    // Cashier: Cannot delete users
    return false;
  };

  const canCreateUser = () => {
    if (!currentUser) return false;

    // HQ Admin: Can create any user
    if (currentUser.role === 'ADMIN') {
      return true;
    }

    // Branch Manager: Can only create cashiers for their branch
    if (currentUser.role === 'BRANCH_MANAGER') {
      return true; // But role and branch will be restricted
    }

    // Cashier: Cannot create users
    return false;
  };

  const handlePasswordChange = async () => {
    if (!passwordTargetUser || !currentUser) return;

    // Validate
    if (passwordData.newPassword.length < 6) {
      setMessage({ type: 'error', text: 'Password must be at least 6 characters long' });
      return;
    }

    if (passwordData.newPassword !== passwordData.confirmPassword) {
      setMessage({ type: 'error', text: 'Passwords do not match' });
      return;
    }

    setPasswordLoading(true);
    setMessage(null);

    try {
      const response = await fetch('/api/auth/change-password', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          userId: passwordTargetUser.id,
          newPassword: passwordData.newPassword,
          requesterUserId: currentUser.id,
        }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        setMessage({ type: 'error', text: data.error || 'Failed to change password' });
        return;
      }

      setMessage({ type: 'success', text: 'Password changed successfully!' });
      setPasswordDialogOpen(false);
      setPasswordData({ newPassword: '', confirmPassword: '' });

      // Clear message after 3 seconds
      setTimeout(() => setMessage(null), 3000);
    } catch (error) {
      console.error('Password change error:', error);
      setMessage({ type: 'error', text: 'Network error. Please try again.' });
    } finally {
      setPasswordLoading(false);
    }
  };

  const openPasswordDialog = (user: User) => {
    if (!canChangePassword(user)) {
      let errorMsg = 'Only HQ Admins can change any password. ';
      if (currentUser?.role === 'BRANCH_MANAGER') {
        errorMsg += 'Branch Managers can change their own password and their cashiers\' passwords.';
      } else {
        errorMsg += 'Cashiers cannot change passwords.';
      }

      setMessage({ type: 'error', text: errorMsg });
      setTimeout(() => setMessage(null), 3000);
      return;
    }

    setPasswordTargetUser(user);
    setPasswordData({ newPassword: '', confirmPassword: '' });
    setMessage(null);
    setPasswordDialogOpen(true);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    // Validate branch manager can only create cashiers for their branch
    if (currentUser?.role === 'BRANCH_MANAGER') {
      if (formData.role !== 'CASHIER') {
        setMessage({ type: 'error', text: 'Branch Managers can only create Cashier accounts' });
        setTimeout(() => setMessage(null), 3000);
        return;
      }
      if (formData.branchId !== currentUser.branchId) {
        setMessage({ type: 'error', text: 'Branch Managers can only create users for their assigned branch' });
        setTimeout(() => setMessage(null), 3000);
        return;
      }
    }

    try {
      if (editingUser) {
        // Branch Manager can only edit cashiers in their branch or themselves
        if (currentUser?.role === 'BRANCH_MANAGER' && editingUser.id !== currentUser.id) {
          if (editingUser.role !== 'CASHIER' || editingUser.branchId !== currentUser.branchId) {
            setMessage({ type: 'error', text: 'You can only edit cashiers in your branch' });
            setTimeout(() => setMessage(null), 3000);
            return;
          }
        }

        // Update user (local state update for now, API endpoint needed for updates)
        setUsers((prev) =>
          prev.map((user) =>
            user.id === editingUser.id
              ? {
                  ...user,
                  username: formData.username,
                  email: formData.email,
                  name: formData.name,
                  role: formData.role,
                }
              : user
          )
        );
      } else {
        // Create new user via API
        // Convert 'hq' to undefined for ADMIN users
        const branchId = formData.branchId === 'hq' ? undefined : formData.branchId;

        const response = await fetch('/api/users', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            username: formData.username,
            email: formData.email,
            name: formData.name,
            role: formData.role,
            password: 'demo123', // Default password for new users
            branchId,
          }),
        });

        const data = await response.json();

        if (!response.ok || !data.success) {
          alert(data.error || 'Failed to create user');
          return;
        }

        // Refresh users list
        fetchUsers();
      }
      setDialogOpen(false);
      resetForm();
    } catch (error) {
      console.error('Failed to save user:', error);
      alert('Failed to save user');
    }
  };

  const handleEdit = (user: User) => {
    if (!canEditUser(user)) {
      setMessage({ type: 'error', text: 'You do not have permission to edit this user' });
      setTimeout(() => setMessage(null), 3000);
      return;
    }

    setEditingUser(user);
    setFormData({
      username: user.username,
      email: user.email,
      name: user.name,
      role: user.role,
      branchId: user.branchId || 'hq',
    });
    setDialogOpen(true);
  };

  const handleDelete = async (userId: string, user: User) => {
    if (!canDeleteUser(user)) {
      setMessage({ type: 'error', text: 'You do not have permission to delete this user' });
      setTimeout(() => setMessage(null), 3000);
      return;
    }

    if (!confirm('Are you sure you want to delete this user?')) return;
    try {
      setUsers((prev) => prev.filter((user) => user.id !== userId));
    } catch (error) {
      console.error('Failed to delete user:', error);
      alert('Failed to delete user');
    }
  };

  const resetForm = () => {
    setEditingUser(null);
    setFormData({
      username: '',
      email: '',
      name: '',
      role: 'CASHIER',
      branchId: currentUser?.role === 'BRANCH_MANAGER' ? currentUser.branchId || '' : '',
    });
  };

  const getRoleBadge = (role: string) => {
    switch (role) {
      case 'ADMIN':
        return <Badge className="bg-gradient-to-r from-[#C7A35A] to-[#b88e3b] text-white font-semibold shadow-sm">HQ Admin</Badge>;
      case 'BRANCH_MANAGER':
        return <Badge className="bg-gradient-to-r from-[#0F3A2E] to-[#0B2B22] text-white font-semibold shadow-sm">Branch Manager</Badge>;
      case 'CASHIER':
        return <Badge className="bg-[#F4F0EA] text-[#0F3A2E] border border-[#C7A35A]/30 font-semibold shadow-sm">Cashier</Badge>;
      default:
        return <Badge>{role}</Badge>;
    }
  };

  const filteredUsers = users.filter((user) => {
    // Branch Manager: Only show users from their branch
    if (currentUser?.role === 'BRANCH_MANAGER') {
      if (user.branchId !== currentUser.branchId && user.id !== currentUser.id) {
        return false;
      }
    }

    const matchesSearch =
      user.username.toLowerCase().includes(searchTerm.toLowerCase()) ||
      user.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
      user.name?.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesRole = roleFilter === 'all' || user.role === roleFilter;
    return matchesSearch && matchesRole;
  });

  const getAvailableRoles = () => {
    if (currentUser?.role === 'BRANCH_MANAGER') {
      // Branch Manager can only create cashiers
      return roles.filter(r => r.value === 'CASHIER');
    }
    return roles;
  };

  return (
    <div className="min-h-screen">
      {/* Beautiful Coffee-Themed Background */}
      <div className="fixed inset-0 -z-10 opacity-20">
        <div className="absolute inset-0 bg-gradient-to-br from-[#0F3A2E] via-[#0B2B22] to-[#C7A35A]"></div>
        <div className="absolute inset-0 opacity-30">
          {/* Coffee bean patterns */}
          <svg className="w-full h-full" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <pattern id="coffee-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
                <circle cx="50" cy="50" r="30" fill="none" stroke="#C7A35A" strokeWidth="1" opacity="0.1"/>
              </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#coffee-pattern)"/>
          </svg>
        </div>
      </div>

      {/* Main Content */}
      <div className="relative z-10 min-h-screen flex flex-col">
        <div className="flex-1 bg-gradient-to-br from-[#FFFDF8] to-[#F4F0EA] dark:from-[#0F3A2E] dark:to-[#0B2B22]">
          <div className="container mx-auto px-4 py-6">
            <div className="space-y-6">
              <Card className="border-[#C7A35A]/20 shadow-xl">
                <CardHeader>
                  <CardTitle className="flex items-center gap-2 text-[#0F3A2E] dark:text-[#FFFDF8]">
                    <Shield className="h-6 w-6 text-[#C7A35A]" />
                    User Management
                    {currentUser?.role === 'BRANCH_MANAGER' && (
                      <Badge variant="outline" className="ml-2 border-amber-500 text-amber-700">
                        <EyeOff className="h-3 w-3 mr-1" />
                        Confidential
                      </Badge>
                    )}
                  </CardTitle>
                  <CardDescription className="text-[#0F3A2E]/70 dark:text-[#FFFDF8]/70">
                    {currentUser?.role === 'BRANCH_MANAGER' ? (
                      <div>
                        <strong>Branch Manager View:</strong> You can only manage cashiers assigned to your branch. 
                        Other branches' users are hidden for security and privacy reasons.
                      </div>
                    ) : (
                      'Create and manage users with role-based permissions. HQ Admins have full control over all branches.'
                    )}
                  </CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="flex flex-col md:flex-row gap-4">
                    <div className="flex-1 relative">
                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-[#C7A35A]" />
                      <Input
                        placeholder="Search users..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="pl-10 border-[#C7A35A]/30 focus:border-[#C7A35A]"
                      />
                    </div>

                    <Select value={roleFilter} onValueChange={setRoleFilter}>
                      <SelectTrigger className="md:w-[200px] border-[#C7A35A]/30">
                        <SelectValue placeholder="All Roles" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="all">All Roles</SelectItem>
                        {roles.map((role) => (
                          <SelectItem key={role.value} value={role.value}>
                            {role.label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  {canCreateUser() && (
                    <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>
                      <DialogTrigger asChild>
                        <Button onClick={resetForm} className="bg-gradient-to-r from-[#C7A35A] to-[#b88e3b] hover:from-[#b88e3b] hover:to-[#C7A35A] text-white shadow-md">
                          <Plus className="h-4 w-4 mr-2" />
                          {currentUser?.role === 'BRANCH_MANAGER' ? 'Add Cashier' : 'Add User'}
                        </Button>
                      </DialogTrigger>
                      <DialogContent className="sm:max-w-[500px]">
                        <form onSubmit={handleSubmit}>
                          <DialogHeader>
                            <DialogTitle>{editingUser ? 'Edit User' : 'Add New User'}</DialogTitle>
                          </DialogHeader>
                          <div className="space-y-4 py-4">
                            <div className="space-y-2">
                              <Label htmlFor="username" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Username</Label>
                              <Input
                                id="username"
                                value={formData.username}
                                onChange={(e) => setFormData({ ...formData, username: e.target.value })}
                                placeholder="e.g., cashier1"
                                required
                              />
                            </div>
                            <div className="space-y-2">
                              <Label htmlFor="email" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Email</Label>
                              <Input
                                id="email"
                                type="email"
                                value={formData.email}
                                onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                                placeholder="user@franchise.com"
                                required
                              />
                            </div>
                            <div className="space-y-2">
                              <Label htmlFor="name" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Full Name (Optional)</Label>
                              <Input
                                id="name"
                                value={formData.name}
                                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                placeholder="e.g., John Doe"
                              />
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label htmlFor="role" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Role</Label>
                                <Select
                                  value={formData.role}
                                  onValueChange={(value: any) => setFormData({ ...formData, role: value })}
                                  disabled={currentUser?.role === 'BRANCH_MANAGER'}
                                >
                                  <SelectTrigger id="role">
                                    <SelectValue />
                                  </SelectTrigger>
                                  <SelectContent>
                                    {getAvailableRoles().map((role) => (
                                      <SelectItem key={role.value} value={role.value}>
                                        <div className="flex flex-col">
                                          <span>{role.label}</span>
                                          <span className="text-xs text-slate-500">{role.description}</span>
                                        </div>
                                      </SelectItem>
                                    ))}
                                  </SelectContent>
                                </Select>
                                {currentUser?.role === 'BRANCH_MANAGER' && (
                                  <p className="text-xs text-slate-500 mt-1">Branch Managers can only create Cashier accounts</p>
                                )}
                              </div>
                              <div className="space-y-2">
                                <Label htmlFor="branch" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Branch</Label>
                                <Select
                                  value={formData.branchId}
                                  onValueChange={(value: any) => setFormData({ ...formData, branchId: value })}
                                  disabled={currentUser?.role === 'BRANCH_MANAGER'}
                                >
                                  <SelectTrigger id="branch">
                                    <SelectValue placeholder="Select Branch" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="hq">None (HQ Admin)</SelectItem>
                                    <SelectItem value="1">Downtown</SelectItem>
                                    <SelectItem value="2">Airport</SelectItem>
                                  </SelectContent>
                                </Select>
                                {currentUser?.role === 'BRANCH_MANAGER' && (
                                  <p className="text-xs text-slate-500 mt-1">Your branch is pre-selected</p>
                                )}
                              </div>
                            </div>
                          </div>
                          <DialogFooter>
                            <Button type="button" variant="outline" onClick={() => setDialogOpen(false)}>
                              Cancel
                            </Button>
                            <Button type="submit" className="bg-gradient-to-r from-[#C7A35A] to-[#b88e3b] hover:from-[#b88e3b] hover:to-[#C7A35A] text-white">
                              {editingUser ? 'Update' : 'Add'} User
                            </Button>
                          </DialogFooter>
                        </form>
                      </DialogContent>
                    </Dialog>
                  )}
                </CardContent>
              </Card>

              <Card className="border-[#C7A35A]/20 shadow-xl">
                <CardHeader>
                  <CardTitle className="text-[#0F3A2E] dark:text-[#FFFDF8]">
                    Users ({filteredUsers.length})
                    {currentUser?.role === 'BRANCH_MANAGER' && (
                      <span className="text-sm font-normal text-slate-500 ml-2">(Your Branch Only)</span>
                    )}
                  </CardTitle>
                </CardHeader>
                <CardContent>
                  {loading ? (
                    <div className="text-center py-8 text-[#0F3A2E]/70 dark:text-[#FFFDF8]/70">Loading...</div>
                  ) : (
                    <ScrollArea className="h-[500px]">
                      <Table>
                        <TableHeader>
                          <TableRow className="bg-[#F4F0EA] dark:bg-[#0B2B22]">
                            <TableHead>Username</TableHead>
                            <TableHead>Email</TableHead>
                            <TableHead>Name</TableHead>
                            <TableHead>Role</TableHead>
                            <TableHead>Branch</TableHead>
                            <TableHead>Status</TableHead>
                            <TableHead>Created</TableHead>
                            <TableHead className="text-right">Actions</TableHead>
                          </TableRow>
                        </TableHeader>
                        <TableBody>
                          {filteredUsers.map((user) => (
                            <TableRow key={user.id}>
                              <TableCell className="font-medium">{user.username}</TableCell>
                              <TableCell>{user.email}</TableCell>
                              <TableCell>{user.name || '-'}</TableCell>
                              <TableCell>{getRoleBadge(user.role)}</TableCell>
                              <TableCell>{user.branchName || '-'}</TableCell>
                              <TableCell>
                                <Badge variant={user.isActive ? 'default' : 'secondary'}>
                                  {user.isActive ? 'Active' : 'Inactive'}
                                </Badge>
                              </TableCell>
                              <TableCell>{user.createdAt.toLocaleDateString()}</TableCell>
                              <TableCell className="text-right">
                                <div className="flex justify-end gap-2">
                                  {canChangePassword(user) && (
                                    <Button
                                      variant="ghost"
                                      size="icon"
                                      onClick={() => openPasswordDialog(user)}
                                      className="hover:text-[#C7A35A]"
                                      title="Change Password"
                                    >
                                      <Key className="h-4 w-4" />
                                    </Button>
                                  )}
                                  {canEditUser(user) && (
                                    <Button
                                      variant="ghost"
                                      size="icon"
                                      onClick={() => handleEdit(user)}
                                      title="Edit User"
                                    >
                                      <Pencil className="h-4 w-4" />
                                    </Button>
                                  )}
                                  {canDeleteUser(user) && (
                                    <Button
                                      variant="ghost"
                                      size="icon"
                                      onClick={() => handleDelete(user.id, user)}
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      title="Delete User"
                                    >
                                      <Trash2 className="h-4 w-4" />
                                    </Button>
                                  )}
                                </div>
                              </TableCell>
                            </TableRow>
                          ))}
                          {filteredUsers.length === 0 && (
                            <TableRow>
                              <TableCell colSpan={7} className="text-center py-8 text-[#0F3A2E]/70 dark:text-[#FFFDF8]/70">
                                No users found
                              </TableCell>
                            </TableRow>
                          )}
                        </TableBody>
                      </Table>
                    </ScrollArea>
                  )}
                </CardContent>
              </Card>
            </div>
          </div>
        </div>

        {/* Change Password Dialog */}
        <Dialog open={passwordDialogOpen} onOpenChange={setPasswordDialogOpen}>
          <DialogContent className="sm:max-w-[500px]">
            <DialogHeader>
              <DialogTitle className="flex items-center gap-2">
                <Lock className="h-5 w-5 text-[#C7A35A]" />
                Change Password
              </DialogTitle>
              <p className="text-sm text-[#0F3A2E]/70 dark:text-[#FFFDF8]/70">
                Changing password for: <strong>{passwordTargetUser?.username}</strong>
                {passwordTargetUser?.name && ` (${passwordTargetUser.name})`}
              </p>
            </DialogHeader>
            <div className="space-y-4 py-4">
              {message && (
                <div className={`flex items-center gap-2 p-3 rounded-lg ${
                  message.type === 'success'
                    ? 'bg-green-50 text-green-700 border border-green-200'
                    : 'bg-red-50 text-red-700 border border-red-200'
                }`}>
                  {message.type === 'success' ? (
                    <div className="h-4 w-4 text-green-600" />
                  ) : (
                    <AlertCircle className="h-4 w-4 text-red-600" />
                  )}
                  <span className="text-sm">{message.text}</span>
                </div>
              )}
              <div className="space-y-2">
                <Label htmlFor="newPassword" className="text-[#0F3A2E] dark:text-[#FFFDF8]">New Password</Label>
                <Input
                  id="newPassword"
                  type="password"
                  placeholder="Enter new password (min 6 characters)"
                  value={passwordData.newPassword}
                  onChange={(e) => setPasswordData({ ...passwordData, newPassword: e.target.value })}
                  className="border-[#C7A35A]/30 focus:border-[#C7A35A]"
                  disabled={passwordLoading}
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="confirmPassword" className="text-[#0F3A2E] dark:text-[#FFFDF8]">Confirm Password</Label>
                <Input
                  id="confirmPassword"
                  type="password"
                  placeholder="Confirm new password"
                  value={passwordData.confirmPassword}
                  onChange={(e) => setPasswordData({ ...passwordData, confirmPassword: e.target.value })}
                  className="border-[#C7A35A]/30 focus:border-[#C7A35A]"
                  disabled={passwordLoading}
                />
              </div>
            </div>
            <DialogFooter>
              <Button
                type="button"
                variant="outline"
                onClick={() => {
                  setPasswordDialogOpen(false);
                  setPasswordData({ newPassword: '', confirmPassword: '' });
                  setMessage(null);
                }}
              >
                Cancel
              </Button>
              <Button
                onClick={handlePasswordChange}
                className="bg-gradient-to-r from-[#C7A35A] to-[#b88e3b] hover:from-[#b88e3b] hover:to-[#C7A35A] text-white"
                disabled={passwordLoading}
              >
                {passwordLoading ? 'Changing...' : 'Change Password'}
              </Button>
            </DialogFooter>
          </DialogContent>
        </Dialog>
      </div>
    </div>
  );
}
